<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than diagrams.net -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1542px" height="2301px" viewBox="-0.5 -0.5 1542 2301" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2022-10-31T04:12:10.887Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/106.0.0.0 Safari/537.36&quot; etag=&quot;8zVr6e1fUu4h3JMpSIXp&quot; version=&quot;20.5.1&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;z4_MealT-lZueBOhtil7&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><defs/><g><rect x="0" y="0" width="500" height="200" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 484px; height: 1px; padding-top: 7px; margin-left: 9px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style="font-size: 14px;"><b>Functional</b></div><div style="font-size: 14px;">1. 发布图文，视频</div><div style="font-size: 14px;">2. 关注，被关注</div><div style="font-size: 14px;">3. 浏览信息流</div><div style="font-size: 14px;"><br /></div><div style="font-size: 14px;"><b>Non-functional</b></div><div style="font-size: 14px;">1. Low latency：阅读信息流低响应时间</div><div style="font-size: 14px;"><span style="background-color: initial;">2. High </span><span style="background-color: initial;">Availability: </span><span style="background-color: initial;">保证整个系统的高可用</span></div><div style="font-size: 14px;"><div>3. High scalability: 支持大量用户使用</div></div><div style="font-size: 14px;"><br style="font-size: 14px;" /></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="9" y="21" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">Functional...</text></switch></g><rect x="0" y="210" width="500" height="460" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 484px; height: 1px; padding-top: 217px; margin-left: 9px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style=""><b>Capacity Estimation (Optional)</b><br /></div><div style=""><b><br /></b></div><div style=""><b>QPS</b></div><div style="font-size: 14px;">假设：</div><div style="font-size: 14px;"><span style="white-space: pre;">	</span>一千万 DAU 用户 * 100 请求/天</div><div style="font-size: 14px;"><span style="background-color: initial;"><span style="white-space: pre;">	</span>读写比 = 100:1</span></div><div style="font-size: 14px;">结论：</div><div style="font-size: 14px;"><span style="white-space: pre;">	</span>系统需要支撑大约 10,000 QPS</div><div style="font-size: 14px;"><span style="background-color: initial;"><span style="white-space: pre;">	</span>read QPS </span><span style="background-color: initial;">≈ 10,000 QPS</span></div><div style="font-size: 14px;"><span style="background-color: initial;"><span style="white-space: pre;">	</span>write QPS </span><span style="background-color: initial;">≈ </span><span style="background-color: initial;">100 </span></div><div style="font-size: 14px;"><span style="background-color: initial;"><br /></span></div><div style="font-size: 14px;"><span style="background-color: initial;"><b>Storage</b></span></div><div style="font-size: 14px;"><span style="background-color: initial;">假设：</span></div><div style="font-size: 14px;"><span style="background-color: initial;"><span style="white-space: pre;">	</span>平均每个帖子占用空间为 5 Mb（包括图文与视频）</span></div><div style="font-size: 14px;">结论：</div><div style="font-size: 14px;"><span style="white-space: pre;">	</span>每天新增帖子数量为 9 百万条<br /></div><div style="font-size: 14px;"><span style="white-space: pre;">	</span>每天新增存储为 45 Tb<br /></div><div style="font-size: 14px;"><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;"><b>Throughout</b><br /></span></div><div style=""><span style="background-color: initial;">假设：</span></div><div style=""><span style="background-color: initial;"><span style="font-weight: bold; white-space: pre;">	</span>根据 QPS 和 Storage 的假设<br /></span></div><div style=""><span style="background-color: initial;"><span style="white-space: pre;">	</span>每次读取 20 条信息流<br /></span></div><div style=""><span style="background-color: initial;">结论：</span></div><div style=""><span style="background-color: initial;"><span style="white-space: pre;">	</span>下载带宽：2 百万条帖子/每秒 * 5 Mb = 10 Tb/s<br /></span></div><div style=""><span style="background-color: initial;"><span style="white-space: pre;">	</span>上传带宽：100 帖子/每秒 * 5 Mb = 500 Mb/s<br /></span></div><div style=""><span style="background-color: initial;"><b><br /></b></span></div><div style="font-size: 14px;"><span style="background-color: initial;"> </span></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="9" y="231" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">Capacity Estimation (Optional)...</text></switch></g><rect x="0" y="680" width="500" height="440" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 484px; height: 1px; padding-top: 687px; margin-left: 9px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style=""><b style="background-color: initial;">练习与总结</b></div><div style=""><b style="background-color: initial;"><br /></b></div><div style=""><b style="background-color: initial;">Key points</b><br /></div><div style=""><b>- </b><span style="background-color: initial;">根据用户粉丝数量制定混合策略：</span><span style="background-color: initial;">Fanout /</span><span style="background-color: initial;">Pull/Push,</span></div><div>- 使用指针和日志追加型数据库记录多设备读取位置</div><div>- 保证 Read-Your-Writes Consistency</div><div>- 从用户 ID 或者数据 ID 维度进行数据存储分区</div><div><br /></div><div><div><b style="background-color: initial;">Patterns</b><br /></div><div>- Asynchronous Request-Reply pattern: <span style="background-color: initial;">异步上传图片和视频，无需等待上传完成就能继续其他任务</span></div><div>- <span style="background-color: initial;">Retry pattern: 上传资源或发布评论失败后可以自动进行重试。</span></div><div><span style="background-color: initial;">- </span><span style="background-color: initial;">Sharding pattern: 对用户或者资源进行分片存储</span></div></div><div style=""><b><br /></b></div><div><b>Real Life Architectures</b></div><div style=""><span style="background-color: initial;">- Video: Real-Time Delivery Architecture at Twitter</span><br /></div><div>- Video: How We Learned to Stop Worrying and Love Fan-In at Twitter</div><div>- Blog: <span style="background-color: initial;">Sharding &amp; IDs at Instagram</span></div><div>- Blog: <span style="background-color: initial;">Video Upload Latency Improvements at Instagram</span><br /></div><div><br /></div><div><div><div><b>Similar applications</b></div><div>- IM：在群组中，每条信息需要发布到多个其他成员（fanout）</div><div><span style="background-color: initial;">- Video</span>：上传视频以及浏览视频</div></div></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="9" y="701" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">练习与总结Key points...</text></switch></g><rect x="510" y="0" width="1030" height="1120" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><path d="M 620 200 L 640 200 L 630 200 L 643.63 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 648.88 200 L 641.88 203.5 L 643.63 200 L 641.88 196.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><ellipse cx="580" cy="200" rx="40" ry="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 200px; margin-left: 541px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Client</div></div></div></foreignObject><text x="580" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Client</text></switch></g><path d="M 770 290 L 803.63 290" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 808.88 290 L 801.88 293.5 L 803.63 290 L 801.88 286.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="650" y="260" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 290px; margin-left: 651px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><div>Media Server</div></div></div></div></foreignObject><text x="710" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Media Server</text></switch></g><path d="M 770 200 L 803.63 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 808.88 200 L 801.88 203.5 L 803.63 200 L 801.88 196.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 770 200 L 790 200 L 790 120 L 803.63 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 808.88 120 L 801.88 123.5 L 803.63 120 L 801.88 116.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 710 230 L 710 250 L 710 240 L 710 253.63" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 710 258.88 L 706.5 251.88 L 710 253.63 L 713.5 251.88 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><rect x="650" y="170" width="120" height="60" rx="13.2" ry="13.2" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 651px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">API Gateway</div></div></div></foreignObject><text x="710" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">API Gateway</text></switch></g><path d="M 1075 200 L 1112.67 200 L 1112.67 120 L 1133.63 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1138.88 120 L 1131.88 123.5 L 1133.63 120 L 1131.88 116.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 965 230 L 985 170 L 1085 170 L 1065 230 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 966px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Queue</div></div></div></foreignObject><text x="1025" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Queue</text></switch></g><path d="M 1200 150 L 1200 241.13" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1200 246.38 L 1196.5 239.38 L 1200 241.13 L 1203.5 239.38 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 213px; margin-left: 1200px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">aync</div></div></div></foreignObject><text x="1200" y="217" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">aync</text></switch></g><path d="M 1200 150 L 1200 190 L 1365 190 L 1365 241.13" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1365 246.38 L 1361.5 239.38 L 1365 241.13 L 1368.5 239.38 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 192px; margin-left: 1283px;"><div data-drawio-colors="color: rgb(0, 0, 0); background-color: rgb(255, 255, 255); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; background-color: rgb(255, 255, 255); white-space: nowrap;">sync</div></div></div></foreignObject><text x="1283" y="195" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="11px" text-anchor="middle">sync</text></switch></g><rect x="1140" y="90" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 1141px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Work Server</div></div></div></foreignObject><text x="1200" y="124" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Work Server</text></switch></g><path d="M 1310 262.5 C 1310 254.22 1334.62 247.5 1365 247.5 C 1379.59 247.5 1393.58 249.08 1403.89 251.89 C 1414.21 254.71 1420 258.52 1420 262.5 L 1420 322.5 C 1420 330.78 1395.38 337.5 1365 337.5 C 1334.62 337.5 1310 330.78 1310 322.5 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><path d="M 1420 262.5 C 1420 270.78 1395.38 277.5 1365 277.5 C 1334.62 277.5 1310 270.78 1310 262.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 304px; margin-left: 1311px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;">Database</div></div></div></foreignObject><text x="1365" y="308" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Database</text></switch></g><rect x="520" y="390" width="1010" height="150" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 994px; height: 1px; padding-top: 397px; margin-left: 529px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style="">1. Client 向 Token Server 申请上传 Token 用作资源（图片，视频）上传，Token 记录过期时间以及权限等信息</div><div style="">2. Client 通过 Media Server 将资源上传到 Media Storage，上传完成后 Media Storage 会返回资源元数据给 Client</div><div style="">3. Client 将发布贴文时，将文字和对应的资源元数据通过 API Gateway 发送到 Web Server，Web Server 将该事件发送到 Queue</div><div style="">4. Work Server 订阅了发布事件，它<span style="background-color: initial;">从 User Relationship (Graph Database) 获取关注了此用户的关注者数量，</span><span style="background-color: initial;">根据关注者数量决定使用哪种策略：</span></div><div style=""><span style="">	</span><span style="white-space: pre;">	</span>4.1 关注者数量少：使用 Fanout，将数据写入到 Database，然后将该 Post ID 插入到每位关注者的 Timeline Cache 中（Timeline Cache 仅包括 Post ID, <span style="white-space: pre;">	</span>      User ID 的对应关系）</div><div style=""><span style="">	</span><span style="white-space: pre;">	</span>4.2 关注者数量多：使用 Pull，将数据写入到 Database 中，待关注者浏览信息流的时候再将 Post ID 写入到该关注者的 Timeline Cache 中<br /></div><div style="font-size: 14px;"><br /></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="529" y="411" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">1. Client 向 Token Server 申请上传 Token 用作资源（图片，视频）上传，Token 记录过期时间以及权限等信息...</text></switch></g><rect x="0" y="1130" width="500" height="620" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 491px; height: 1px; padding-top: 1137px; margin-left: 9px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style="font-size: 16px;"><div style=""><div style=""><b>API Design</b></div><div style=""><b><br /></b></div><div style="">method: POST</div><div style="">https://example.com/api/v1/news/</div><div style=""><b><br /></b></div><div style="">upload_resources(user_id, resources)</div><div style=""><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>meta_data = get_meta(<span style="">	</span><span style="">	</span><span style="background-color: initial;">resources)</span><br /></div><div style=""><span style="background-color: initial;"><span style="">	</span><span style="">	</span><span style="">	</span><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>token = </span><span style="background-color: initial;">get_token(user_id, </span><span style="background-color: initial;">meta_data</span><span style="background-color: initial;">)</span></div><div style=""><span style="background-color: initial;"><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>upload_info = upload(user_id, token, resources)<br /></span></div><div style=""><span style="background-color: initial;"><span style="">	</span><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>return upload_info<br /></span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style="">post(user_id, resource, text)</div><div style=""><span style="background-color: initial;"><span style="">	</span></span><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>upload_info<span style="background-color: initial;"> = upload_resources(user_id, resources)</span></div><div style=""><span style="background-color: initial;"><span style="">	</span><span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>if upload_info.status == Success<br /></span></div><div style=""><span style=""><span style=""></span><span style="">	</span><span style="">	<span style="">	</span></span><span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>post_info</span> = send(user_id, text, res)</div><div style="">	<span style="">	</span><span style="">	</span><span style="white-space: pre;">	</span>return post_info</div><div style=""><br /></div><div style=""><div>method: GET</div><div>https://example.com/api/v1/news/?user_id=1<span style="background-color: initial;">&amp;offset=2</span></div><div><br /></div></div><div style=""><div>read(user_id, offset):</div></div></div></div><blockquote style="margin: 0 0 0 40px; border: none; padding: 0px;"><div style="font-size: 16px;"><div style=""><div style="">meta_data = <span style="background-color: initial;">get_timeline(user_id, offset)</span></div><div>resources = get_resources(meta_data)</div><div>newsfeed = merge(<span style="background-color: initial;">meta_data, </span><span style="background-color: initial;">resources)</span></div><div style="">return newsfeed</div></div></div></blockquote><div style="font-size: 16px;"><div style=""><div style=""><span style="background-color: initial;"><span style="">	</span></span></div><div style=""><br /></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="">	</span><span style="">	</span><br /></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="9" y="1151" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">API Design...</text></switch></g><rect x="510" y="1130" width="1030" height="620" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1021px; height: 1px; padding-top: 1137px; margin-left: 519px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: all; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style=""><br /></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="519" y="1151" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">...</text></switch></g><path d="M 532.5 1180 L 532.5 1150 L 1520 1150 L 1520 1180" fill="rgb(255, 255, 255)" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><path d="M 532.5 1180 L 532.5 1300 L 1520 1300 L 1520 1180" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 532.5 1180 L 1520 1180" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 532.5 1220 L 860.5 1220 L 1189.5 1220 L 1520.5 1220" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 532.5 1260 L 860.5 1260 L 1189.5 1260 L 1520.5 1260" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 860.5 1180 L 860.5 1220 L 860.5 1260 L 860.5 1300" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><path d="M 1189.5 1180 L 1189.5 1220 L 1189.5 1260 L 1189.5 1300" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="14px"><text x="1025.75" y="1170.5">User (SQL)</text></g><path d="M 532.5 1180 M 860.5 1180 M 860.5 1220 M 532.5 1220" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 326px; height: 1px; padding-top: 1200px; margin-left: 534px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Name</div></div></div></foreignObject><text x="697" y="1204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Name</text></switch></g><path d="M 860.5 1180 M 1189.5 1180 M 1189.5 1220 M 860.5 1220" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 327px; height: 1px; padding-top: 1200px; margin-left: 862px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Type</div></div></div></foreignObject><text x="1025" y="1204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Type</text></switch></g><path d="M 1189.5 1180 M 1520.5 1180 M 1520.5 1220 M 1189.5 1220" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 329px; height: 1px; padding-top: 1200px; margin-left: 1191px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Note</div></div></div></foreignObject><text x="1355" y="1204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Note</text></switch></g><path d="M 532.5 1220 M 860.5 1220 M 860.5 1260 M 532.5 1260" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 326px; height: 1px; padding-top: 1240px; margin-left: 534px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id</div></div></div></foreignObject><text x="697" y="1244" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">user_id</text></switch></g><path d="M 860.5 1220 M 1189.5 1220 M 1189.5 1260 M 860.5 1260" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 327px; height: 1px; padding-top: 1240px; margin-left: 862px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">UUID</div></div></div></foreignObject><text x="1025" y="1244" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">UUID</text></switch></g><path d="M 1189.5 1220 M 1520.5 1220 M 1520.5 1260 M 1189.5 1260" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 329px; height: 1px; padding-top: 1240px; margin-left: 1191px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Primary key</div></div></div></foreignObject><text x="1355" y="1244" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Primary key</text></switch></g><path d="M 532.5 1260 M 860.5 1260 M 860.5 1300 M 532.5 1300" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 326px; height: 1px; padding-top: 1280px; margin-left: 534px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">meta_data</div></div></div></foreignObject><text x="697" y="1284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">meta_data</text></switch></g><path d="M 860.5 1260 M 1189.5 1260 M 1189.5 1300 M 860.5 1300" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 327px; height: 1px; padding-top: 1280px; margin-left: 862px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">multiple</div></div></div></foreignObject><text x="1025" y="1284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">multiple</text></switch></g><path d="M 1189.5 1260 M 1520.5 1260 M 1520.5 1300 M 1189.5 1300" fill="none" stroke="#999999" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 329px; height: 1px; padding-top: 1280px; margin-left: 1191px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 36px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">name, profile, etc.﻿</div></div></div></foreignObject><text x="1355" y="1284" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">name, profile, etc.﻿</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 127px; height: 1px; padding-top: 35px; margin-left: 521px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: normal; overflow-wrap: normal;">发布图文，视频</div></div></div></foreignObject><text x="584" y="40" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">发布图文，视频</text></switch></g><path d="M 930 200 L 950 200 L 945 200 L 968.63 200" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 973.88 200 L 966.88 203.5 L 968.63 200 L 966.88 196.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="810" y="170" width="120" height="60" rx="13.2" ry="13.2" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 200px; margin-left: 811px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Web Server</div></div></div></foreignObject><text x="870" y="204" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Web Server</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 585px; margin-left: 521px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 16px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; font-weight: bold; white-space: normal; overflow-wrap: normal;">浏览信息流</div></div></div></foreignObject><text x="565" y="590" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="16px" text-anchor="middle" font-weight="bold">浏览信息流</text></switch></g><path d="M 640 870 L 673.63 870" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 678.88 870 L 671.88 873.5 L 673.63 870 L 671.88 866.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 640 870 L 660 870 L 660 760 L 673.63 760" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 678.88 760 L 671.88 763.5 L 673.63 760 L 671.88 756.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><ellipse cx="600" cy="870" rx="40" ry="40" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 870px; margin-left: 561px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Client</div></div></div></foreignObject><text x="600" y="874" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Client</text></switch></g><rect x="520" y="960" width="1010" height="120" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 994px; height: 1px; padding-top: 967px; margin-left: 529px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style="">1. Client 通过 API Gateway 访问 Timeline Mixer，Timeline Mixer 会通过 Timeline Service 和 Other Server（例如广告）合并 Client 的 NewsFeed，其中资源文件 会通过 CDN 获取</div><div style="font-size: 14px;">2. Timeline Service 从 Timeline Cache 中获取 Client 的 Post ID 列表，然后请求 User Service, Post Service 等组件获取贴文对应的数据</div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="529" y="981" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">1. Client 通过 API Gateway 访问 Timeline Mixer，Timeline Mixer 会通过 Timeline Service 和 Other Server（例如广告）合并 Client 的 NewsFeed，其中资源文件 会通过 CDN 获取...</text></switch></g><path d="M 1085 615 C 1085 606.72 1109.62 600 1140 600 C 1154.59 600 1168.58 601.58 1178.89 604.39 C 1189.21 607.21 1195 611.02 1195 615 L 1195 675 C 1195 683.28 1170.38 690 1140 690 C 1109.62 690 1085 683.28 1085 675 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1195 615 C 1195 623.28 1170.38 630 1140 630 C 1109.62 630 1085 623.28 1085 615" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 657px; margin-left: 1086px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Database</div></div></div></foreignObject><text x="1140" y="661" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Database</text></switch></g><path d="M 800 870 L 838.63 870" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 843.88 870 L 836.88 873.5 L 838.63 870 L 836.88 866.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="680" y="840" width="120" height="60" rx="13.2" ry="13.2" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 870px; margin-left: 681px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">API Gateway</div></div></div></foreignObject><text x="740" y="874" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">API Gateway</text></switch></g><rect x="810" y="90" width="120" height="60" rx="13.2" ry="13.2" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 120px; margin-left: 811px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Token Server</div></div></div></foreignObject><text x="870" y="124" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Token Server</text></switch></g><path d="M 530 1350 L 530 1320 L 1520 1320 L 1520 1350" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 530 1350 L 530 1450 L 1520 1450 L 1520 1350" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 530 1350 L 1520 1350" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 750 1350 L 750 1380 L 750 1410 L 750 1440" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="14px"><text x="1024.5" y="1340.5">News (NoSQL)</text></g><path d="M 530 1350 M 750 1350 M 750 1380 M 530 1380" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1365px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1369" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1350 M 1520 1350 M 1520 1380 M 750 1380" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 762px; height: 1px; padding-top: 1365px; margin-left: 758px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, resources_id_list, news_content, create_time</div></div></div></foreignObject><text x="758" y="1369" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, resources_id_list, news_content, create_time</text></switch></g><path d="M 530 1380 M 750 1380 M 750 1410 M 530 1410" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1395px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1399" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1380 M 1520 1380 M 1520 1410 M 750 1410" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><path d="M 530 1410 M 750 1410 M 750 1440 M 530 1440" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1425px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1429" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1410 M 1520 1410 M 1520 1440 M 750 1440" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 762px; height: 1px; padding-top: 1425px; margin-left: 758px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, resources_id_list, news_content, create_time</div></div></div></foreignObject><text x="758" y="1429" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, resources_id_list, news_content, create_time</text></switch></g><rect x="810" y="260" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 290px; margin-left: 811px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div>Media Storage</div></div></div></div></foreignObject><text x="870" y="294" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Media Storage</text></switch></g><path d="M 1145 262.5 C 1145 254.22 1169.62 247.5 1200 247.5 C 1214.59 247.5 1228.58 249.08 1238.89 251.89 C 1249.21 254.71 1255 258.52 1255 262.5 L 1255 322.5 C 1255 330.78 1230.38 337.5 1200 337.5 C 1169.62 337.5 1145 330.78 1145 322.5 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1255 262.5 C 1255 270.78 1230.38 277.5 1200 277.5 C 1169.62 277.5 1145 270.78 1145 262.5" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 304px; margin-left: 1146px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Timeline Cache</div></div></div></foreignObject><text x="1200" y="308" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Timeline Cache</text></switch></g><path d="M 1125 870 L 1163.63 870" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1168.88 870 L 1161.88 873.5 L 1163.63 870 L 1161.88 866.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1065 840 L 1065 796.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1065 791.12 L 1068.5 798.12 L 1065 796.37 L 1061.5 798.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1065 840 L 1065 810 L 1210 810 L 1210 796.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1210 791.12 L 1213.5 798.12 L 1210 796.37 L 1206.5 798.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="1005" y="840" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 870px; margin-left: 1006px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Timeline Service</div></div></div></foreignObject><text x="1065" y="874" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Timeline Service</text></switch></g><path d="M 1310 120 L 1266.37 120" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1261.12 120 L 1268.12 116.5 L 1266.37 120 L 1268.12 123.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1310 90 C 1310 81.72 1334.62 75 1365 75 C 1379.59 75 1393.58 76.58 1403.89 79.39 C 1414.21 82.21 1420 86.02 1420 90 L 1420 150 C 1420 158.28 1395.38 165 1365 165 C 1334.62 165 1310 158.28 1310 150 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1420 90 C 1420 98.28 1395.38 105 1365 105 C 1334.62 105 1310 98.28 1310 90" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 132px; margin-left: 1311px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">User<br />Relationship</div></div></div></foreignObject><text x="1365" y="136" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">User...</text></switch></g><path d="M 965 870 L 998.63 870" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1003.88 870 L 996.88 873.5 L 998.63 870 L 996.88 866.5 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 905 840 L 905 796.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 905 791.12 L 908.5 798.12 L 905 796.37 L 901.5 798.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="845" y="840" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 870px; margin-left: 846px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Timeline Mixer</div></div></div></foreignObject><text x="905" y="874" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Timeline Mixer</text></switch></g><path d="M 1065 730 L 1065 710 L 1140 710 L 1140 696.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1140 691.12 L 1143.5 698.12 L 1140 696.37 L 1136.5 698.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="1005" y="730" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 1006px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">User Service</div></div></div></foreignObject><text x="1065" y="764" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">User Service</text></switch></g><path d="M 1210 730 L 1210 710 L 1140 710 L 1140 696.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1140 691.12 L 1143.5 698.12 L 1140 696.37 L 1136.5 698.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="1150" y="730" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 1151px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Post Service</div></div></div></foreignObject><text x="1210" y="764" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Post Service</text></switch></g><rect x="845" y="730" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 846px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Other Service</div></div></div></foreignObject><text x="905" y="764" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Other Service</text></switch></g><path d="M 1170 840 C 1170 831.72 1194.62 825 1225 825 C 1239.59 825 1253.58 826.58 1263.89 829.39 C 1274.21 832.21 1280 836.02 1280 840 L 1280 900 C 1280 908.28 1255.38 915 1225 915 C 1194.62 915 1170 908.28 1170 900 Z" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 1280 840 C 1280 848.28 1255.38 855 1225 855 C 1194.62 855 1170 848.28 1170 840" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 108px; height: 1px; padding-top: 882px; margin-left: 1171px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">Timeline Cache</div></div></div></foreignObject><text x="1225" y="886" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Timeline Cache</text></switch></g><rect x="680" y="630" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 660px; margin-left: 681px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div>Media Storage</div></div></div></div></foreignObject><text x="740" y="664" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">Media Storage</text></switch></g><path d="M 740 730 L 740 696.37" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 740 691.12 L 743.5 698.12 L 740 696.37 L 736.5 698.12 Z" fill="rgb(0, 0, 0)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><rect x="680" y="730" width="120" height="60" rx="9" ry="9" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 760px; margin-left: 681px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><div>CDN</div></div></div></div></foreignObject><text x="740" y="764" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">CDN</text></switch></g><path d="M 530 1490 L 530 1460 L 1520 1460 L 1520 1490" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 530 1490 L 530 1590 L 1520 1590 L 1520 1490" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 530 1490 L 1520 1490" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><path d="M 750 1490 L 750 1520 L 750 1550 L 750 1580" fill="none" stroke="rgb(0, 0, 0)" stroke-miterlimit="10" pointer-events="none"/><g fill="rgb(0, 0, 0)" font-family="Helvetica" font-weight="bold" pointer-events="none" text-anchor="middle" font-size="14px"><text x="1024.5" y="1480.5">NewsFeed (NoSQL)</text></g><path d="M 530 1490 M 750 1490 M 750 1520 M 530 1520" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1505px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1509" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1490 M 1520 1490 M 1520 1520 M 750 1520" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 762px; height: 1px; padding-top: 1505px; margin-left: 758px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, other_data</div></div></div></foreignObject><text x="758" y="1509" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, other_data</text></switch></g><path d="M 530 1520 M 750 1520 M 750 1550 M 530 1550" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1535px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1539" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1520 M 1520 1520 M 1520 1550 M 750 1550" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 762px; height: 1px; padding-top: 1535px; margin-left: 758px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, other_data</div></div></div></foreignObject><text x="758" y="1539" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, other_data</text></switch></g><path d="M 530 1550 M 750 1550 M 750 1580 M 530 1580" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 218px; height: 1px; padding-top: 1565px; margin-left: 531px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: center; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">news_id</div></div></div></foreignObject><text x="640" y="1569" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px" text-anchor="middle">news_id</text></switch></g><path d="M 750 1550 M 1520 1550 M 1520 1580 M 750 1580" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 762px; height: 1px; padding-top: 1565px; margin-left: 758px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, other_data</div></div></div></foreignObject><text x="758" y="1569" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, other_data</text></switch></g><path d="M 751 1380 M 1420 1380 M 1420 1410 M 751 1410" fill="none" stroke="rgb(0, 0, 0)" stroke-linecap="square" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 661px; height: 1px; padding-top: 1395px; margin-left: 759px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left; max-height: 26px; overflow: hidden;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;">user_id, resources_id_list, news_content, create_time</div></div></div></foreignObject><text x="759" y="1399" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">user_id, resources_id_list, news_content, create_time</text></switch></g><rect x="0" y="1760" width="1540" height="540" fill="rgb(255, 255, 255)" stroke="rgb(0, 0, 0)" pointer-events="none"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility" style="overflow: visible; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 1531px; height: 1px; padding-top: 1767px; margin-left: 9px;"><div data-drawio-colors="color: rgb(0, 0, 0); " style="box-sizing: border-box; font-size: 0px; text-align: left;"><div style="display: inline-block; font-size: 14px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; pointer-events: none; white-space: normal; overflow-wrap: normal;"><p style="line-height: 0.9; font-size: 14px;"></p><div style=""><div style=""><div style=""><font style="font-size: 14px;"><b>  </b></font><b style="background-color: initial;">Explain</b></div><div style=""><b style="background-color: initial;"><br /></b></div><div style=""><b style="background-color: initial;">  </b><span style="background-color: initial;">1. 为什么 </span><span style="background-color: initial;">Non-functional </span><span style="background-color: initial;">不关注 Consistency？</span></div><div style=""><span style="background-color: initial;">      大部分 NewsFeed 的业务要求 </span><span style="background-color: initial;">eventually </span><span style="background-color: initial;">consistency，少部分要求 strong </span><span style="background-color: initial;">consistency，所以这里没有强调，不过如果面试官关注的话，那么可以提出这点。（来源：</span><span style="background-color: initial;">https://blog.twitter.com/engineering/en_us/a/2014/manhattan-our-real-time-multi-tenant-distributed-database-for-twitter-scale）</span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;">  2. 为什么上传资源的时候，要使用 Media Service 而不直接上传到 Web Server？</span></div><div style=""><span style="background-color: initial;">      如果直接使用 Web Server 的话会浪费大量的带宽，因为 Web Server 接下来会将资源上传到 </span><span style="background-color: initial;">Media Service。</span><span style="background-color: initial;">拆分之后，使用 API Gateway 找到最佳的 </span><span style="background-color: initial;">Media Service 来负责上传功能</span><span style="background-color: initial;">，</span><span style="background-color: initial;">Media Service 可以根据上传功能调整物理分布以及专注在上传功能优化，Web Server 也可以专注在发布以及浏览信息流。</span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;">  3. 发布过程中的 User Relationship</span><span style="background-color: initial;"> 里面具体存储的是什么？</span></div><div style=""><span style="background-color: initial;">      里面以图的形式存储的是社交关系网，例如 A 关注了 B，C 评论的 D 是其中的两条边，Meta 使用的是 Tao（具体信息：</span><span style="background-color: initial;">https://engineering.fb.com/2013/06/25/core-data/tao-the-power-of-the-graph/），Twitter 使用的是 FlockDB（具体信息：</span><span style="background-color: initial;">https://blog.twitter.com/engineering/en_us/a/2010/introducing-flockdb）</span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;">  4. API Design 中，为什么使用 offset 来请求？这样在浏览过程中如果有新的 news，请求不会浏览到重复 news 吗？</span></div><div style=""><span style="background-color: initial;">      </span><span style="background-color: initial;">这里的 offset 指的是类似 start_after(id) 也就是每次 read 都会指定只从某个位置开始读取，不过这里要注意，如果 news 会被更新（例如股票行情），删除（该用户被封禁）</span><span style="background-color: initial;">或者它的赞或者热门评论会被更新。</span><span style="background-color: initial;">那么用户会期望浏览之前的 NewsFeed 可以看到实时更新的内容。这时候需要考虑 real time listener，具体细节参考：https://www.youtube.com/watch?v=poqTHxtDXwU</span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;">  5. 为什么 User 表选择 SQL，而其他表选择 NoSQL？</span></div><div style=""><span style="background-color: initial;">      </span><span style="background-color: initial;">User 表选择 SQL 是从功能扩展性进行考虑的，例如之后有用户修改个人资料的功能，那么我们会期望修改资料是 </span><span style="background-color: initial;">Atomic 的（虽然现在不少 NoSQL database 都支持 ACID，例如 Google Cloud 的 </span><span style="background-color: initial;">Firestore）实际应用上，Instagram 和 Twitter 的 User 表都是使用 NoSQL 进行存储的（</span><span style="background-color: initial;">Instagram 使用的是 Cassandra（来源：</span><span style="background-color: initial;">https://www.youtube.com/watch?v=_BfMH4GQWnk&amp;t=218s）</span><span style="background-color: initial;">，Twitter 使用的是 </span><span style="background-color: initial;">Manhattan（</span><span style="background-color: initial;">https://blog.twitter.com/engineering/en_us/a/2014/manhattan-our-real-time-multi-tenant-distributed-database-for-twitter-scale），News 和 NewsFeed 表使用 NoSQL 保证 High Scalability。</span></div><div style=""><span style="background-color: initial;"><br /></span></div><div style=""><span style="background-color: initial;">  6. </span><span style="background-color: initial;">如果某位用户的关注者数量在设定的阈值浮动会造成 pull 和 fanout 模式中频繁切换吗？这种情况要如何处理？</span></div><div style=""><span style="background-color: initial;">      对于用户表的状态切换或者维护，可以</span><span style="background-color: initial;">使用后台线程定期检查，检查到符合条件的用户时，将事件发送给消息队列，然后让其他 Work Server 进行处理，相比每次更新完用户表就进行检查，这样可以减少数据库压力，同时通过分离业务功能，使得系统更容易维护。</span></div><div style=""><span style="background-color: initial;">      </span><span style="background-color: initial;">情景 1：如果用户关注者数量达到阈值，修改该用户的状态为 pull 或 fanout，如果从 pull 修改到 fanout 的话，那么需要将该用户之前的 News 写入到关注者 Timeline Cache 中。</span></div><div>      情景 2：如果用户注册一周年会送礼物或者粉丝达到一定数量后送奖牌（Youtube），后台线程需定期检查用户注册时间以及粉丝数。</div><div>      情景 3：检查用户是否不活跃，例如检查 100 天没有登录的用户，可以发邮件通知他们上线或者先不要将数据写入他们的 Timeline Cache 中，减少数据写入量。</div><div><span style="background-color: initial;"><br /></span></div></div></div><p style="font-size: 14px;"></p></div></div></div></foreignObject><text x="9" y="1781" fill="rgb(0, 0, 0)" font-family="Helvetica" font-size="14px">Explain...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Text is not SVG - cannot display</text></a></switch></svg>